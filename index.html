<!DOCTYPE html>
<html>
    <title>Infinite Recharge Scouting App</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <div class="w3-row w3-light-grey w3-border-bottom w3-border-black tabBar">
        <button class="w3-row-item w3-button" onclick="openTab('matches')">Matches</button><!--
        <button class="w3-row-item w3-button" onclick="openTab('teams')">Teams</button>
        <button class="w3-row-item w3-button" onclick="openTab('info')" id="infoTab">Info</button>-->
        <button class="w3-row-item w3-button" onclick="openTab('sync')">Sync</button>
    </div>

    <div id="matches" class="w3-container tab" style="display:none">
        <div class='w3-bar-block' id='matchListContainer'></div>
    </div>

    <div id="scouting" class="w3-container tab" style="display:none">
        <div class="scoutCont">
            <img src="https://raw.githubusercontent.com/Machoo/ViperbotsScoutingApp/master/ScoutingApp/2020FieldFlipped.png" height="540px" onclick="addSpot(event)" id="field">
            <img src="https://raw.githubusercontent.com/Machoo/ViperbotsScoutingApp/master/ScoutingApp/2020PowerPort.PNG" height="291px" class="powerPortPic">
            <div class="button scout_button pickup_button" onclick="scoutButton('pickup')" id="pickup">Pickup</div>
            <div class="button scout_button shoot_button" onclick="scoutButton('shoot')" id="shoot">Shooting</div>
            <div class="button scout_button endgam_button" onclick="scoutButton('endgam')" id="endgam">Endgame</div>
            <div class="powerPortButtonsCont">
                <rect class="button powerPortButton small">Inner</rect>
                <div class="button powerPortButton small" onclick="powerPort('small')" id="small">Inner</div>
                <rect class="button powerPortButton big">Outer</rect>
                <div class="button powerPortButton big" onclick="powerPort('big')" id="big">Outer</div>
                <rect class="button powerPortButton miss">Miss</rect>
                <div class="button powerPortButton miss" onclick="powerPort('miss')" id="miss">Miss</div>
                <rect class="button powerPortButton other">Other</rect>
                <div class="button powerPortButton other" onclick="powerPort('other')" id="other">Other</div>
                <rect class="button powerPortButton low">Lower</rect>
                <div class="button powerPortButton low" onclick="powerPort('low')" id="low">Lower</div>
            </div>
            <div class="powerPortButtonsCont hide" id="endgameButtonCont">
                <p>Attmpted:<br><br>Successful:<br><br>Level:<br><br>Host:</p>
                <div class="button endgameButton check" style="top: 25px; box-shadow: 2px 2px black;" onclick="scoutButton('attempt_true')" id="attempt_true">&#x2713;</div>
                <div class="button endgameButton ex" style="top: 25px; box-shadow: 2px 2px black;" onclick="scoutButton('attempt_false')" id="attempt_false">X</div>
                <div class="button endgameButton check" style="top: 163px; box-shadow: 2px 2px black;" onclick="scoutButton('success_true')" id="success_true">&#x2713;</div>
                <div class="button endgameButton ex" style="top: 163px; box-shadow: 2px 2px black;" onclick="scoutButton('success_false')" id="success_false">X</div>
                <div class="button endgameButton check" style="top: 94px; box-shadow: 2px 2px black;" onclick="scoutButton('level_true')" id="level_true">&#x2713;</div>
                <div class="button endgameButton ex" style="top: 94px; box-shadow: 2px 2px black;" onclick="scoutButton('level_false')" id="level_false">X</div>
                <div class="button endgameButton check" style="top: 232px; box-shadow: 2px 2px black;" onclick="scoutButton('buddy_true')" id="buddy_true">&#x2713;</div>
                <div class="button endgameButton ex" style="top: 232px; box-shadow: 2px 2px black;" onclick="scoutButton('buddy_false')" id="buddy_false">X</div>
            </div>
            <rect height="290px" width="286.03" class="cover" id="shade"></rect>
        </div>
        <button onclick="startMatch()" id="matchButton" style="width: 100%; position: absolute; left: 0px">Start Match</button>
    </div>


    <div id="teams" class="w3-container tab" style="display:none">
        <table class="w3-table" id="teamsListContainer"></table>
    </div>


    <div id="info" class="w3-container tab" style="display:none">
        <table class="w3-table" id="statsList"></table>
    </div>


    <div id="sync" class="w3-container tab syncy" style="display:none">
        <p></p>
        Event Code: <input type="text" name="eventCode" id="eventCodeIn">
        <p></p>
        <div style="width: 50%; margin: auto">
            <button class="w3-button" onclick="importTBA()" style="display: inline-block">Import from TBA</button>
            <p id="checkImportTBA" style="display: inline-block">Not downloaded</p>
        </div>
        <p></p>
        <div style="width: 50%; margin: auto">
            <button class="w3-button" onclick="importFB()" id="importFB" style="display: inline-block">Import from Firebase</button>
            <p id="checkImportFB" style="display: inline-block">Not downloaded</p>
        </div>
        <p></p>
        Password: <input type="text" name="password" id="passwordIn">
        <p></p>
        <div style="width: 50%; margin: auto">
            <button class="w3-button" onclick="exportFB()" id="exportFB" style="display: inline-block">Export to Firebase</button>
            <p id="checkExportFB" style="display: inline-block">Not uploaded</p>
        </div>
        <p></p>
        <p></p>
        <div style="width: 50%; margin: auto">
            <button class="w3-button" onclick="changeColor('blue')" style="display: inline-block; background-color: rgb(0, 0, 255); color: rgb(255, 255, 255)">Blue</button>
            <button class="w3-button" onclick="changeColor('red')" style="display: inline-block; background-color: rgb(255, 0, 0); color: rgb(0, 0, 0)">Red</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.6.0/math.js"></script>
    <script src="https://raw.githubusercontent.com/Machoo/machoo.github.io/master/min_tba.js"></script>

    <script>
        var firebaseConfig = {
            apiKey: "",
            authDomain: "scootingapp.firebaseapp.com",
            databaseURL: "https://scootingapp.firebaseio.com", //instead of scootingapp, viperbotsvalor
            projectId: "scootingapp",
            storageBucket: "scootingapp.appspot.com",
            messagingSenderId: "557439690320",
            appId: "1:557439690320:web:0abe450663381b2b3d1355",
            measurementId: "G-QEXK8P2F85"
        };
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
        var db = firebase.firestore();
        fbTeams = db.collection("teams"); //this has all initialized the Firebase connection
        //2019txaus
        
        var rawMatchImport = [];
        function importTBA() {
            var tba = new TBA();
            tba.getTeams(document.getElementById("eventCodeIn").value, function(teams) {
                document.getElementById("checkImportTBA").innerHTML = "Downloaded";
                for (i = 0; i < teams.length; i++) {
                    var teamExistsImport = false;
                    stats.forEach(function(teamThing) {
                        if (teamThing.team_number == teams[i].substring(3)) {
                            teamExistsImport = true;
                        }
                    });
                    if (!teamExistsImport) {
                        stats.push({"team_number": teams[i].substring(3),
                                    "lvl1Hatches": 0,
                                    "lvl1Cargo": 0,
                                    "lvl2Hatches": 0,
                                    "lvl2Cargo": 0,
                                    "lvl3Hatches": 0,
                                    "lvl3Cargo": 0,
                                    "habStart1": 0,
                                    "habStart2": 0,
                                    "habEnd0": 0,
                                    "habEnd1": 0,
                                    "habEnd2": 0,
                                    "habEnd3": 0,
                                    "teammatesCarried": 0,
                                    "matches": []});
                    }
                }
            });

            tba.getMatches(document.getElementById("eventCodeIn").value, function(matches) {
                rawMatchImport = matches;
            })

            butt = document.getElementById("checkImportTBA");
            butt.style.backgroundColor = "rgb(0, 255, 0, 1)";
            var bopacity = 1;
            var fadeEffect = setInterval(function () {
                if (bopacity > 0) {
                    bopacity -= 0.005;
                    butt.style.backgroundColor = "rgb(0, 255, 0, " + bopacity + ")";
                } else {
                    clearInterval(fadeEffect);
                }
            }, 15);
        }

        var docs = [];
        var docsID = [];
        var stats = [];
        var lastStat = "lvl1Hatches";
        var lastMatchTemp = "";
        var teamTemp = 0;
        var matchRow = 0;
        var matchCol = 0;
        var firstMatch = 0;
        var variables = ["Num", "Lvl 1<br>Hatches", "Lvl 1<br>Cargo", "Lvl 2<br>Hatches", "Lvl 2<br>Cargo", "Lvl 3<br>Hatches", "Lvl 3<br>Cargo", "Hab<br>Start 1", "Hab<br>Start 2", "Hab<br>End 0", "Hab<br>End 1", "Hab<br>End 2", "Hab<br>End 3", "Teammates<br>Carried"];
        var variablesReal = ["team_number", "lvl1Hatches", "lvl1Cargo", "lvl2Hatches", "lvl2Cargo", "lvl3Hatches", "lvl3Cargo", "habStart1", "habStart2", "habEnd0", "habEnd1", "habEnd2", "habEnd3", "teammatesCarried"];
        openTab('sync');

        function importFB() {
            fbTeams.get().then(function(querySnapshot) {
                querySnapshot.forEach(function(doc) {
                    docs.push(doc.data());
                    docsID.push(doc.id);
                    var teamExistsImportFB = false;
                    stats.forEach(function(teamThing) {
                        if (teamThing.team_number == doc.data().team_number) {
                            teamExistsImportFB = true;
                        }
                    });
                    if (!teamExistsImportFB) {
                        stats.push({"team_number": doc.data().team_number,
                                    "lvl1Hatches": doc.data().lvl1Hatches,
                                    "lvl1Cargo": doc.data().lvl1Cargo,
                                    "lvl2Hatches": doc.data().lvl2Hatches,
                                    "lvl2Cargo": doc.data().lvl2Cargo,
                                    "lvl3Hatches": doc.data().lvl3Hatches,
                                    "lvl3Cargo": doc.data().lvl3Cargo,
                                    "habStart1": doc.data().habStart1,
                                    "habStart2": doc.data().habStart2,
                                    "habEnd0": doc.data().habEnd0,
                                    "habEnd1": doc.data().habEnd1,
                                    "habEnd2": doc.data().habEnd2,
                                    "habEnd3": doc.data().habEnd3,
                                    "teammatesCarried": doc.data().teammatesCarried,
                                    "matches": doc.data().matches});
                    }
                });
            });

            butt = document.getElementById("checkImportFB");
            butt.style.backgroundColor = "rgb(0, 255, 0, 1)";
            var bopacity = 1;
            var fadeEffect = setInterval(function () {
                if (bopacity > 0) {
                    bopacity -= 0.005;
                    butt.style.backgroundColor = "rgb(0, 255, 0, " + bopacity + ")";
                } else {
                    clearInterval(fadeEffect);
                }
            }, 15);

            setTimeout(function() {
                for (var i = 0; i < docs.length; i++) {
                    for (var j = 0; j < stats.length; j++) {
                        if (docs[i].team_number == stats[j].team_number) {
                            stats[j] = docs[i];
                        }
                    }
                }

                document.getElementById("checkImportFB").innerHTML = "Downloaded";
            }, 3000);
        }

        function exportFB() {
            if (document.getElementById("passwordIn").value == "dank") {
                for (var i = 0; i < stats.length; i++) { //iterate through the stats array
                    var teamExists = false;
                    for (var j = 0; j < docs.length; j++) { //iterate through the docs
                        if (stats[i].team_number == docs[j].team_number) { //check if the team already exists...
                            for (var k = 0; k < stats[i].matches.length; k++) { //for each match (from stats)...
                                var matchExists = false;
                                for (var l = 0; l < docs[j].matches.length - 1; l++) { //for each match (from docs)...
                                    if (stats[i].matches[k] == docs[j].matches[l]) { //if the matches match...
                                        matchExists = true; //don't add a new one
                                    }
                                }
                                if (!matchExists) { //otherwise add a new one
                                    db.collection("teams").doc(docsID[j]).set(stats[i]);
                                }
                            }
                            teamExists = true;
                        }
                    }
                    if (!teamExists) {
                        fbTeams.add(stats[i]);
                    }
                }
            }

            butt = document.getElementById("checkExportFB");
            butt.style.backgroundColor = "rgb(0, 255, 0, 1)";
            var bopacity = 1;
            var fadeEffect = setInterval(function () {
                if (bopacity > 0) {
                    bopacity -= 0.005;
                    butt.style.backgroundColor = "rgb(0, 255, 0, " + bopacity + ")";
                } else {
                    clearInterval(fadeEffect);
                }
            }, 15);

            setTimeout(function() {
                if (document.getElementById("passwordIn").value == "dank") {
                    document.getElementById("checkExportFB").innerHTML = "Uploaded";
                } else {
                    document.getElementById("passwordIn").value = "WRONG";
                }
            }, 3000);
        }

        function showTeamsList() {
            while (document.getElementById('teamsListContainer').firstChild) {
                document.getElementById('teamsListContainer').removeChild(document.getElementById('teamsListContainer').firstChild);
            }
            var teamsList = document.createElement('w3-bar-block');

            for (var i = 0; i < variables.length; i++) {
                var table_variable = document.createElement('td');
                table_variable.setAttribute('class', 'w3-button');
                table_variable.setAttribute('onclick', 'sortTeams(variablesReal[' + i + '], ' + i + ')');
                table_variable.innerHTML = variables[i];
                document.getElementById('teamsListContainer').appendChild(table_variable);
            }

            for (var i = 0; i < stats.length; i++) {
                var team = document.createElement('tr');
                if (i % 2 == 0) {
                    team.setAttribute("style", "background-color: rgb(220, 220, 220)");
                }

                for (var j = 0; j < variablesReal.length; j++) {
                    var table_element = document.createElement('td');
                    if (j == 0) {
                        table_element.setAttribute('class', 'w3-button w3-left-align');
                        table_element.setAttribute('onclick', 'showTeam(' + stats[i].team_number + ')');
                    }
                    table_element.innerHTML = stats[i][variablesReal[j]];
                    team.appendChild(table_element);
                }

                document.getElementById('teamsListContainer').appendChild(team);
            }
        }

        function sortTeams(sortStat, col) {
            if (sortStat == "team_number") {
                stats.sort(function(a, b) {return a.team_number - b.team_number});
            } else {
                stats.sort(function(a, b) {return b[sortStat] - a[sortStat]});
            }
            showTeamsList();
            for (var i = 0; i < stats.length; i++) {
                document.getElementById('teamsListContainer').rows[i].cells[col].setAttribute('style', 'background-color: rgb(0, 255, 0)');
                if (i % 2 == 1) {
                    document.getElementById('teamsListContainer').rows[i].cells[col].setAttribute('style', 'background-color: rgb(150, 255, 150)');
                }
            }
        }

        function showMatchList() {
            var matchList = document.createElement('w3-bar-block');

            var actualMatchNum = 0;
            for (var i = 0; i < rawMatchImport.length; i++) {
                if (rawMatchImport[i].comp_level == "qm") {
                    actualMatchNum += 1;
                    var actualMatch = rawMatchImport.find(function(matchThing) {return ((actualMatchNum == matchThing.match_number) && (matchThing.comp_level == "qm"));});
                    var match = document.createElement('w3-bar-item');
                    match.setAttribute('class', 'w3-bar-item w3-row');

                    for (var r = 0; r < 3; r++) {
                        var teamR = document.createElement('w3-bar-item');
                        teamR.setAttribute('class', 'w3-col w3-button w3-center');
                        teamR.setAttribute('style', 'background-color: red; color: white');
                        teamR.setAttribute('onclick', 'scoutTeam(' + actualMatch.alliances.red.team_keys[r].substring(3) + ',' + (actualMatchNum - 1) + ',' + r + ')');
                        teamR.appendChild(document.createTextNode(actualMatch.alliances.red.team_keys[r].substring(3)));
                        match.appendChild(teamR);
                    }

                    var matchNum = document.createElement('w3-bar-item');
                    matchNum.setAttribute('class', 'w3-col w3-center w3-button');
                    matchNum.setAttribute('onclick', 'alert("Stop that please.")');
                    matchNum.innerHTML = actualMatchNum;
                    if (i % 2 == 0) {
                        matchNum.setAttribute('style', 'background-color: lightgrey');
                    }
                    match.appendChild(matchNum);

                    for (var b = 0; b < 3; b++) {
                        var teamB = document.createElement('w3-bar-item');
                        teamB.setAttribute('class', 'w3-col w3-button w3-center');
                        teamB.setAttribute('style', 'background-color: blue; color: white');
                        teamB.setAttribute('onclick', 'scoutTeam(' + actualMatch.alliances.blue.team_keys[b].substring(3) + ',' + (actualMatchNum - 1) + ',' + (b + 4) + ')');
                        teamB.appendChild(document.createTextNode(actualMatch.alliances.blue.team_keys[b].substring(3)));
                        match.appendChild(teamB);
                    }
                    matchList.appendChild(match);
                }
            }

            while (document.getElementById('matchListContainer').firstChild) {
                document.getElementById('matchListContainer').removeChild(document.getElementById('matchListContainer').firstChild);
            }
            
            document.getElementById('matchListContainer').appendChild(matchList);
            if (firstMatch > 0) {
                document.getElementById('matchListContainer').children[0].children[matchRow].children[matchCol].setAttribute('style', 'background-color: rgb(0, 255, 0); color: white;');
            }
        }

        for (var i = 0; i < variables.length; i++) {
            var table_variable = document.createElement('td');
            table_variable.setAttribute('class', 'w3-button');
            table_variable.setAttribute('style', 'border-color: black; border-bottom-style: solid');
            table_variable.innerHTML = variables[i];
            if (i == 0) {
                table_variable.innerHTML = "Match<br>Num";
            }
            document.getElementById('statsList').appendChild(table_variable);
        }

        var total = document.createElement('tr');
        total.setAttribute("style", "background-color: rgb(220, 220, 220)");
        var totalLabel = document.createElement('td');
        totalLabel.innerHTML = "Total";
        total.appendChild(totalLabel);
        for (var j = 1; j < variablesReal.length; j++) {
            var table_total = document.createElement('td');
            table_total.innerHTML = 0;
            total.appendChild(table_total);
        }
        var rows = 1;
        document.getElementById('statsList').appendChild(total);

        function showTeam(teamNum) {
            while (document.getElementById('statsList').children[15]) {
                document.getElementById('statsList').removeChild(document.getElementById('statsList').children[15]);
            }

            for (var i = 1; i < variablesReal.length; i++) {
                document.getElementById('statsList').rows[0].cells[i].innerHTML = stats.find(function(x) {return x.team_number == teamNum;})[variablesReal[i]];
            }

            for (var i = 0; i < stats.find(function(x) {return x.team_number == teamNum;}).matches.length; i++) {
                var match = document.createElement('tr');
                if (i % 2 != 0) {
                    match.setAttribute("style", "background-color: rgb(220, 220, 220)");
                }
                var match_num = document.createElement('td');
                match_num.innerHTML = i + 1;
                match.appendChild(match_num);
                for (var j = 1; j < variablesReal.length; j++) {
                    var table_element = document.createElement('td');
                    table_element.innerHTML = stats.find(function(x) {return x.team_number == teamNum;}).matches[i][variablesReal[j]];
                    match.appendChild(table_element);
                }
                rows += 1;
                document.getElementById('statsList').appendChild(match);
            }
            
            document.getElementById("infoTab").innerHTML = teamNum;
            openTab('info');
        }

        function scoutTeam(teamNum, teamRow, teamCol) {
            teamTemp = teamNum;
            matchRow = teamRow;
            matchCol = teamCol;
            payload.team = teamNum;
            payload.match = teamRow;
            document.getElementById("shade").style.top = "280px";
            document.getElementById("shade").style.left = "1035px";
            document.getElementById("shade").style.width = "225px";
            document.getElementById("shade").style.height = "291px";
            time = 0;
            buttonType = "start";
            shooting = false;
            spotNum = 1;
            document.getElementById("pickup").className = "button scout_button pickup_button sunk";
            document.getElementById("shoot").className = "button scout_button shoot_button sunk";
            document.getElementById("endgam").className = "button scout_button endgam_button sunk";
            openTab('scouting');
        }

        var buttonType = "start";
        var shooting = false;
        var spotNumTemp = 0;
        function scoutButton(stat) {
            if (stat == "pickup") {
                document.getElementById("shoot").className = "button scout_button shoot_button sunk";
                document.getElementById("endgam").className = "button scout_button endgam_button sunk";
                document.getElementById("pickup").className = "button scout_button pickup_button raised";
                document.getElementById("shoot").innerHTML = "Shooting";
                document.getElementById("shade").style.top = "280px";
                document.getElementById("shade").style.left = "1035px";
                document.getElementById("shade").style.width = "225px";
                document.getElementById("shade").style.height = "291px";
                buttonType = stat;
            } else if (stat == "shoot") {
                document.getElementById("pickup").className = "button scout_button pickup_button sunk";
                document.getElementById("endgam").className = "button scout_button endgam_button sunk";
                document.getElementById("shoot").className = "button scout_button shoot_button raised";
                shooting = true;
                document.getElementById("shade").style.top = "280px";
                document.getElementById("shade").style.left = "1035px";
                document.getElementById("shade").style.width = "225px";
                document.getElementById("shade").style.height = "291px";
                buttonType = stat;
            } else if (stat == "endgam") {
                document.getElementById("pickup").className = "button scout_button pickup_button sunk";
                document.getElementById("shoot").className = "button scout_button shoot_button sunk";
                document.getElementById("endgam").className = "button scout_button endgam_button raised";
                document.getElementById("shoot").innerHTML = "Shooting";
                document.getElementById("endgameButtonCont").style.display = "block";
                document.getElementById("shade").style.top = "30px";
                document.getElementById("shade").style.left = "16px";
                document.getElementById("shade").style.width = "1018px";
                document.getElementById("shade").style.height = "542px";
                payload.endgame.timestamp = parseInt(time.toString());
                buttonType = stat;
            } else if (stat.charAt(stat.length - 2) == 'u') {
                document.getElementById(stat.substring(0, stat.length - 5) + "_false").style.boxShadow = "2px 2px black";
                document.getElementById(stat).style.boxShadow = "-2px -2px black";
                payload.endgame[stat.substring(0, stat.length - 5)] = true;
            } else {
                document.getElementById(stat.substring(0, stat.length - 6) + "_true").style.boxShadow = "2px 2px black";
                document.getElementById(stat).style.boxShadow = "-2px -2px black";
                payload.endgame[stat.substring(0, stat.length - 6)] = false;
            }
        }

        var spotNum2 = 0;
        function powerPort(stat) {
            var butt = document.getElementById(stat);
            document.getElementById("scouting").removeChild(document.getElementById("scouting").lastChild);
            spotNum -= 1;
            spotNum2 -= 1;
            document.getElementById("shoot").innerHTML = (spotNum2) + " left";
            if (stat == "small") {
                payload.events.push({
                    "type": 1,
                    "x": x,
                    "y": y,
                    "timestamp": parseInt(time.toString()),
                    "result": 0
            });} else if (stat == "big") {
                payload.events.push({
                    "type": 1,
                    "x": x,
                    "y": y,
                    "timestamp": parseInt(time.toString()),
                    "result": 1
            });} else if (stat == "low") {
                payload.events.push({
                    "type": 1,
                    "x": x,
                    "y": y,
                    "timestamp": parseInt(time.toString()),
                    "result": 2
            });} else if (stat == "miss") {
                payload.events.push({
                    "type": 1,
                    "x": x,
                    "y": y,
                    "timestamp": parseInt(time.toString()),
                    "result": 3
            });} else if (stat == "clear") {
                payload.events.push({
                    "type": 1,
                    "x": x,
                    "y": y,
                    "timestamp": parseInt(time.toString()),
                    "result": 4
            });}
            if (spotNum2 == 0) {
                scoutButton("pickup");
            }
            butt.setAttribute("style", "background-color: rgb(0, 255, 0);");
            var fadeEffect = setInterval(function () {
                if (!butt.style.opacity) {
                    butt.style.opacity = 1;
                }
                if (butt.style.opacity > 0) {
                    butt.style.opacity -= 0.005;
                } else {
                    clearInterval(fadeEffect);
                }
            }, 10);
        }
        var time = 0;
        function startMatch() {
            document.getElementById("matchButton").setAttribute("onclick", "endMatch()");
            document.getElementById("matchButton").innerHTML = "0.0";
            document.getElementById("scouting").removeChild(document.getElementById("scouting").lastChild);
            var countTime = setInterval(function () {
                if (time <= 150) {
                    time += 0.1;
                    document.getElementById("matchButton").innerHTML = time.toFixed(1);
                } else {
                    clearInterval(countTime);
                    document.getElementById("matchButton").innerHTML = "Submit Match";
                }
            }, 100);
        }

        function endMatch() {
            var dater2 = simplify(payload);
            var qrCode = document.createElement("img");
            qrCode.src = "https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=" + dater2 + "&chld=L|1&choe=UTF-8";
            qrCode.style.height = "90%";
            qrCode.style.position = "absolute";
            qrCode.style.margin = "auto";
            qrCode.style.top = "32px";
            qrCode.style.left = "16px";
            scouting.appendChild(qrCode);
            var doneButton = document.createElement("button");
            doneButton.setAttribute("onclick", "doneScouting()");
            doneButton.innerHTML = "Return to matches";
            doneButton.style.width = "600px";
            doneButton.style.height = "200px";
            doneButton.style.position = "absolute";
            doneButton.style.top = "32px";
            doneButton.style.right = "16px";
            doneButton.style.backgroundColor = "lightGray";
            scouting.appendChild(doneButton);
        }

        function doneScouting() {
            openTab('matches');
            document.getElementById("scouting").removeChild(document.getElementById("scouting").lastChild);
            document.getElementById("scouting").removeChild(document.getElementById("scouting").lastChild);
            document.getElementById('matchListContainer').children[0].children[matchRow].children[matchCol].setAttribute('style', 'background-color: rgb(0, 255, 0); color: white;');
            document.getElementById("matchButton").innerHTML = "Start Match";
            document.getElementById("matchButton").setAttribute("onclick", "startMatch()");
            document.getElementById("endgameButtonCont").style.display = "none";
            while (document.getElementById("scouting").lastChild.id != "matchButton") {
                document.getElementById("scouting").removeChild(document.getElementById("scouting").lastChild);
            }
            document.getElementById("attempt_true").style.boxShadow = "2px 2px black";
            document.getElementById("attempt_false").style.boxShadow = "2px 2px black";
            document.getElementById("success_true").style.boxShadow = "2px 2px black";
            document.getElementById("success_false").style.boxShadow = "2px 2px black";
            document.getElementById("level_true").style.boxShadow = "2px 2px black";
            document.getElementById("level_false").style.boxShadow = "2px 2px black";
            document.getElementById("buddy_true").style.boxShadow = "2px 2px black";
            document.getElementById("buddy_false").style.boxShadow = "2px 2px black";
        }

        function simplify(s) {
            var out = [];
            var A = s.endgame.timestamp & 0xFF;
            A = A | ((s.endgame.buddy & 0x1) << 8);
            A = A | ((s.endgame.success & 0x1) << 9);
            A = A | ((s.endgame.level & 0x1) << 10);
            A = A | ((s.endgame.attempt & 0x1) << 11);
            A = A | ((s.team & 0xFFFF) << 16);
            out.push(A);
            var B = s.events.length & 0x7;
            if (s.alliance == "red") {
                B = B | (0 << 7);
            } else {
                B = B | (1 << 7);
            }
            B = B | ((s.start_position_y & 0xFF) << 8);
            B = B | ((s.start_position_x & 0xFF) << 16);
            B = B | ((s.match & 0xFF) << 24);
            out.push(B);
            for (var i = 0; i < s.events.length; i++) {
                var P = s.events[i].timestamp & 0xFF;
                P = P | ((s.events[i].y & 0xFF) << 8);
                P = P | ((s.events[i].x & 0xFF) << 16);
                P = P | ((s.events[i].result & 0xF) << 24);//this wrong?
                P = P | ((s.events[i].type & 0x1) << 27);  //this wrong?
                out.push(P);
            }
            return out;
        }

        function openTab(tab) {
            var x = document.getElementsByClassName("tab");
            for (var i = 0; i < x.length; i++) {
                x[i].style.display = "none";
            }
            if (tab == 'teams') {
                showTeamsList();
            }
            if (tab == 'matches') {
                showMatchList();
            }
            /*if (tab == 'scouting') {
                document.getElementById("infoTab").innerHTML = teamTemp;
            }*/
            document.getElementById(tab).style.display = "block";
        }
        
        function changeColor(color) {
            if (payload.alliance == "blue") {
                document.getElementById("field").src = "https://raw.githubusercontent.com/Machoo/ViperbotsScoutingApp/master/ScoutingApp/2020Field.PNG";
                payload.alliance = "red";
            } else {
                document.getElementById("field").src = "https://raw.githubusercontent.com/Machoo/ViperbotsScoutingApp/master/ScoutingApp/2020FieldFlipped.png";
                payload.alliance = "blue";
            }
        }

        var spotNum = 1;
        var payload = {
            "match": 107,
            "team": 6800,
            "alliance": "blue",
            "start_position_x": 0,
            "start_position_y": 0,
            "events": [],
            "endgame": {
                "timestamp": 0,
                "attempt": false,
                "success": false,
                "level": false,
                "buddy": false
            }
        };
        var x = 0;
        var y = 0;
        function addSpot(event) {
            var spoot = document.createElement('div');
            spoot.setAttribute("class", "spot");
            spoot.style.left = (event.clientX - 12.5) + "px"
            spoot.style.top = (event.clientY - 12.5) + "px";
            if (buttonType == "pickup") {
                spotNum += 1;
            }
            spoot.innerHTML = spotNum;
            if (buttonType == "shoot") {
                spoot.style.backgroundColor = "rgb(0, 255, 0)";
                spoot.innerHTML = "S";
            } else if (buttonType == "start") {
                var a = document.createElement('rect');
                a.style.position = "absolute";
                a.style.width = "10px";
                a.style.height = "10px";
                a.style.left = (event.clientX - 5) + "px";
                a.style.top = (event.clientY - 5) + "px";
                a.style.borderRadius = "5px";
                a.style.backgroundColor = "rgb(0, 0, 0)";
                document.getElementById("scouting").appendChild(a);
            }
            document.getElementById("scouting").appendChild(spoot);
            if (buttonType == "shoot" && shooting) {
                document.getElementById("shade").style.top = "30px";
                document.getElementById("shade").style.left = "16px";
                document.getElementById("shade").style.width = "1018px";
                document.getElementById("shade").style.height = "542px";
                document.getElementById("shoot").innerHTML = (spotNum) + " left";
                spotNum2 = spotNum;
                document.getElementById("scouting").removeChild(document.getElementById("scouting").lastChild);
            }
            x = parseInt((255 * (event.clientX - 12.5) / 1025).toString());
            y = parseInt((254 * (540 - (event.clientY - 30)) / 540).toString());
            if (buttonType == "start") {
                payload.start_position_x = x;
                payload.start_position_y = y;
                spotNum = 0;
                scoutButton("pickup");
                spotNum = 0;
                document.getElementById("scouting").removeChild(document.getElementById("scouting").lastChild);
            } else if (buttonType == "pickup") {
                payload.events.push({
                    "type": 0,
                    "x": x,
                    "y": y,
                    "timestamp": parseInt(time.toString()),
                    "result": 5
                });
            }
            if (spotNum >= 5) {
                buttonType = "shoot";
                shooting = true;
                document.getElementById("pickup").className = "button scout_button pickup_button sunk";
                document.getElementById("endgam").className = "button scout_button endgam_button sunk";
                document.getElementById("shoot").className = "button scout_button shoot_button raised";
            }
        }
    </script>
</html>



<style>
    body {
        background-color: white;
        color: blue;
    }

    .tabBar {
        height: 31px;
    }

    .tab {
        background-color: white;
    }

    .syncy {
        text-align: center;
    }

    .w3-center {
        width: calc(100% / 7);
    }

    .w3-row-item {
        font-size: 20px;
        width: 24.5%;
        margin: 0;
        padding: 0;
    }

    .label1 {
        width: 40px;
    }

    .scoutCont {
        background-color: lightgrey;
        width: 100%;
        margin: auto;
    }

    .cover {
        position: absolute;
        background-color: rgb(0, 0, 0);
        opacity: 0.5;
        top: 280px;
        left: 1035px;
        width: 229px;
        height: 291px;
    }

    .powerPortPic {
        position: absolute;
        top: 280px;
        left: 1146.5px;
    }

    .powerPortButtonsCont {
        position: absolute;
        top: 280px;
        left: 1035px;
        height: 291px;
        width: 111.5px;
        background-color: rgb(200, 200, 200);
    }

    .hide {
        display: none;
        width: 229px;
        font-size: 23px;
    }

    .powerPortButton {
        position: absolute;
        left: 6px;
        height: 40px;
        width: 100px;
        background-color: darkgray;
        text-align: center;
        user-select: none;
        font-size: 25px;
    }

    .small {
        top: 10px;
    }

    .big {
        top: 68.2px;
    }

    .miss {
        top: 126.4px;
    }

    .other {
        top: 184.6px;
    }

    .low {
        top: 240.8px;
    }

    .fadey {
        background-color: rgba(0, 255, 0, 0);
    }

    .scout_button {
        position: absolute;
        background-color: darkgray;
        user-select: none;
        left: 1044.5px;
        width: 210px;
        height: 60px;
        text-align: center;
        font-size: 40px;
    }

    .pickup_button {
        top: 40px;
    }

    .shoot_button {
        top: 120px;
    }

    .endgam_button {
        top: 200px;
    }

    .endgameButton {
        position: absolute;
        width: 30px;
        height: 30px;
        text-align: center;
        user-select: none;
    }

    .check {
        left: 130px;
        background-color: rgb(0, 255, 0);
    }

    .ex {
        left: 190px;
        background-color: rgb(255, 0, 0);
    }

    .spot {
        position: absolute;
        background-color: rgb(255, 255, 0);
        width: 25px;
        height: 25px;
        border-radius: 12.5px;
        text-align: center;
        user-select: none;
    }

    .raised {
        background-color: rgb(230, 230, 230);
        box-shadow: -1px -1px black;
    }

    .sunk {
        background-color: darkgray;
        box-shadow: 1px 1px black;
    }

    @media only screen and (min-width: 1100px) {
        .w3-row-item {
            font-size: 20px;
            width: 24.5%;
            margin: 0;
            padding: 0;
        }
    }
</style>